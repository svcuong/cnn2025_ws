<launch>

      <!-- ========== Static TF: base_link -> lidar_link ========== -->
      <node pkg="tf2_ros"
            type="static_transform_publisher"
            name="lidar_tf"
            args="0 0 0 0 0 0 base_link lidar_link" />

      <!-- ========== ICP Odometry ========== -->
     <node pkg="rtabmap_odom"
            type="icp_odometry"
            name="icp_odometry"
            output="screen">

            <!-- ✅ BODY FRAME -->
            <param name="frame_id" value="base_link"/>
            <param name="odom_frame_id" value="odom"/>

            <param name="publish_tf" value="true"/>
            <param name="publish_null_when_lost" value="true"/>
            <param name="wait_for_transform_duration" value="0.5"/>

            <param name="subscribe_scan_cloud" value="true"/>

            <param name="Icp/VoxelSize" value="0.3"/>
            <param name="Icp/MaxCorrespondenceDistance" value="4.0"/>
            <param name="Icp/MaxTranslation" value="1.0"/>
            <param name="Icp/MaxRotation" value="1.57"/>

            <remap from="scan_cloud" to="/sensors/lidar/points"/>
      </node>


      



      <!-- ========== RTAB-Map SLAM ========== -->
    <node pkg="rtabmap_slam"
            type="rtabmap"
            name="rtabmap"
            output="screen">

            <!-- Không dùng camera -->
            <param name="subscribe_rgb" value="false"/>
            <param name="subscribe_depth" value="false"/>
            <param name="subscribe_rgbd" value="false"/>
            <param name="subscribe_stereo" value="false"/>

            <!-- Chỉ dùng LiDAR -->
            <param name="subscribe_scan_cloud" value="true"/>

            <!-- TF tolerance -->
            <param name="tf_tolerance" value="0.3"/>

            <param name="frame_id" value="base_link"/>
            <param name="odom_frame_id" value="odom"/>
            <param name="map_frame_id" value="map"/>

            <!-- ICP strategy -->
            <param name="Reg/Strategy" value="1"/>

            <!-- Giảm loop closure giả -->
            <param name="RGBD/ProximityPathMaxNeighbors" value="0"/>

            <!-- Occupancy grid từ LiDAR -->
            <param name="Grid/Sensor" value="0"/>

            <remap from="scan" to="/dummy_scan"/>
            <remap from="scan_cloud" to="/sensors/lidar/points"/>

      </node>



</launch>
